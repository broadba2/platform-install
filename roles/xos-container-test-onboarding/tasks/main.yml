#xos-onboarding-sync tests

- name: Check XOS Onboarding Process
  shell: ps -f | grep "python onboarding-synchronizer.py -C /opt/xos/synchronizers/onboarding/onboarding_synchronizer_config"
  register: result
  until: result | success
  retries: 10
  delay: 5
  tags:
    - skip_ansible_lint # running a sub job

- name: Get Volume Mounts on XOS Onboarding Container
  shell: mount -l #| grep xos_services
  register: volumes
  tags:
    - skip_ansible_lint # running a sub job

- name: Validate Volume Mounts on XOS Onboarding Container
  assert:
    that: "'/opt/xos_services/{{ item.name }}' in volumes.stdout|lower"
  with_items: "{{ xos_services }}"
  when:
    - "'{{ item.name }}' != 'vnodlocal'"
    - "'{{ item.name }}' != 'volt'"